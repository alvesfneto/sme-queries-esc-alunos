

--LISTA DOS CEUS INDICANCO A GESTÃO QUE OS CRIOU E OS CEUS ADMINISTRADOS PELO INTITUTO BACCARELLI
SELECT  
A.cd_unidade_educacao AS CD_CEU,
'CEU' AS SG_TP_UNIDADE,
nm_unidade_educacao AS NM_CEU,
CASE WHEN A.cd_unidade_educacao IN (200793,200794,200795,200798,200799,200800,200801,200803,200804,200805,200806,200807) THEN 'Baccarelli' ELSE NULL END AS OBSERVACAO,
C.GESTÃO
INTO TBL_CEUS_POR_GESTAO
FROM D_UNIDADE_EDUCACAO  A  
JOIN D_UNIDADE_ADMINISTRATIVA B ON A.cd_unidade_educacao=B.cd_unidade_administrativa
JOIN (SELECT 
       A.cd_unidade_educacao,
       cd_ato,
       nr_ato,
       dt_publicacao_dom,
       dt_inicio_ocorrencia_unidade,
       A.dt_atualizacao_tabela,
       CASE
         WHEN dt_publicacao_dom BETWEEN '2001-01-01' AND '2004-12-31' THEN 'Marta Suplicy'
         WHEN dt_publicacao_dom BETWEEN '2005-01-01' AND '2006-06-30' THEN 'José Serra' 
         WHEN dt_publicacao_dom BETWEEN '2006-03-30' AND '2012-12-31' THEN 'Gilberto Kassab' 
         WHEN dt_publicacao_dom BETWEEN '2013-01-01' AND '2016-12-31' THEN 'Fernando Haddad'
         WHEN dt_publicacao_dom BETWEEN '2017-01-01' AND '2004-04-05' THEN 'João Dória'
         WHEN dt_publicacao_dom BETWEEN '2018-04-06' AND '2021-05-15' THEN 'Bruno Covas'
         WHEN dt_publicacao_dom >= '2021-05-16' THEN 'Ricardo Nunes' 
       ELSE NULL END AS GESTÃO 
       
       FROM D_HISTORICO_UNIDADE A
       JOIN D_UNIDADE_ADMINISTRATIVA B ON A.cd_unidade_educacao=B.cd_unidade_administrativa
       WHERE tp_ocorrencia_historica =1 
	     AND tp_unidade_administrativa=19 
		 AND tp_atualizacao_registro  IS NULL) C ON A.cd_unidade_educacao=C.cd_unidade_educacao

--SELECT * FROM TBL_CEUS_POR_GESTAO

/*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*/

--LISTA DOS CEUS E DAS UNIDADES VINCULADAS AOS CEUS

DROP TABLE ##CEUS_UNIDADES_VINCULADAS
SELECT 
CD_ESCOLA,
SG_TP_ESCOLA,
nm_unidade_educacao AS NOMESC,
CASE
    WHEN CD_ESCOLA IN (200183,019260,019279,400512,700038,700547) THEN                  200183
	WHEN CD_ESCOLA IN (700023,400513,019280,019261,200184,090905,700528) THEN           200184 
	WHEN CD_ESCOLA IN (200185,019262,019281,400514,700000,700501) THEN                  200185
	WHEN CD_ESCOLA IN (019198,019282,019263,200186,400515,700010,700511) THEN           200186
	WHEN CD_ESCOLA IN (200187,019264,019284,400516,700017,700520) THEN                  200187
	WHEN CD_ESCOLA IN (700018,400517,200188,019285,019265,700521) THEN                  200188
	WHEN CD_ESCOLA IN (700021,400518,019266,019286,091987,200189,700525) THEN           200189
	WHEN CD_ESCOLA IN (400519,019674,700011,200190,019287,019268,700512) THEN           200190
	WHEN CD_ESCOLA IN (200191,013226,019269,019288,700027,400520,700554) THEN           200191
    WHEN CD_ESCOLA IN (400521,700028,019289,019270,019226,200192,700555) THEN           200192
	WHEN CD_ESCOLA IN (400522,700033,019271,019290,200193,700542) THEN                  200193
	WHEN CD_ESCOLA IN (200194,019292,019272,019330,700034,400523,700543) THEN           200194
	WHEN CD_ESCOLA IN (019273,019293,019640,200195,400524,700040,700551) THEN           200195
	WHEN CD_ESCOLA IN (700041,400525,200196,019364,019294,019274,700552) THEN           200196
	WHEN CD_ESCOLA IN (700012,400526,200197,019276,019295,700514) THEN                  200197
	WHEN CD_ESCOLA IN (700035,400527,200198,019296,019277,700544) THEN                  200198
    WHEN CD_ESCOLA IN (019278,019297,200199,400528,700029,700557) THEN                  200199
	WHEN CD_ESCOLA IN (700042,200200,099121,400529,019298,019299,700550) THEN           200200
	WHEN CD_ESCOLA IN (700002,200201,400534,019302,019303,700507) THEN                  200201
	WHEN CD_ESCOLA IN (094374,019304,019306,700015,400535,200202,700517)THEN            200202
	WHEN CD_ESCOLA IN (019307,019308,200203,400536,700003,700504) THEN                  200203
    WHEN CD_ESCOLA IN (019328,019333,200237,400596,700019,700519) THEN                  200237
	WHEN CD_ESCOLA IN (019334,019329,019214,019227,400597,200238,700024,700529) THEN    200238
	WHEN CD_ESCOLA IN (019335,019338,400598,200239,700004,700508) THEN                  200239
	WHEN CD_ESCOLA IN (019331,019336,200240,400599,700013,700515) THEN                  200240
	WHEN CD_ESCOLA IN (700026,400600,200241,019332,019337,700533) THEN                  200241
	WHEN CD_ESCOLA IN (200243,400669,700005,019360,019352,700509) THEN                  200243
	WHEN CD_ESCOLA IN (700006,400670,200244,019353,019361,700505) THEN                  200244
	WHEN CD_ESCOLA IN (700007,400671,200245,019362,019354,700510) THEN                  200245
	WHEN CD_ESCOLA IN (019355,019363,200246,700016,400672,700516) THEN                  200246
	WHEN CD_ESCOLA IN (019368,019369,019315,019310,200247,400673,700020,700522)THEN     200247
	WHEN CD_ESCOLA IN (019365,019357,200248,700031,400674,700536) THEN                  200248
	WHEN CD_ESCOLA IN (019358,019366,200249,700043,400675,700553) THEN                  200249
	WHEN CD_ESCOLA IN (019359,019367,200250,400676,700030,700556) THEN                  200250
	WHEN CD_ESCOLA IN (400684,700039,200251,019371,019373,700548) THEN                  200251
	WHEN CD_ESCOLA IN (019374,019383,200252,400688,700008,700506) THEN                  200252
	WHEN CD_ESCOLA IN (200253,400689,700009,019375,019384,700503) THEN                  200253
	WHEN CD_ESCOLA IN (019385,019376,700022,400690,200254,700526) THEN                  200254
	WHEN CD_ESCOLA IN (400691,700025,200255,019377,019386,700530) THEN                  200255
	WHEN CD_ESCOLA IN (400692,700001,200256,019387,019551,019378,700502) THEN           200256
	WHEN CD_ESCOLA IN (400693,700032,200257,400282,019379,019388,019234,700537)THEN     200257
	WHEN CD_ESCOLA IN (200258,400694,700036,019389,019380,700541) THEN                  200258
	WHEN CD_ESCOLA IN (019392,019390,200259,400695,700037,700540) THEN                  200259
    WHEN CD_ESCOLA IN (700044,400696,200260,019382,019391,700549) THEN                  200260
	WHEN CD_ESCOLA IN (019441,019442,019313,700014,400710,200261,700513) THEN           200261
	WHEN CD_ESCOLA IN (091979,400702,400703,400709,700045,200262,095044,700524) THEN    200262
    WHEN CD_ESCOLA IN (019659,200793,700046,700527) THEN                                200793
    WHEN CD_ESCOLA IN (200794,700047,019657,700531) THEN                                200794
    WHEN CD_ESCOLA IN (019665,200795,700048,700535) THEN                                200795
    WHEN CD_ESCOLA IN (200798,019667,700049,700523) THEN                                200798
    WHEN CD_ESCOLA IN (019661,200799,700050,700518) THEN                                200799
    WHEN CD_ESCOLA IN (200800,019668,700051,700532) THEN                                200800
    WHEN CD_ESCOLA IN (019671,200801,700052,700534) THEN                                200801
	WHEN CD_ESCOLA IN (200803,019663,700053,700545) THEN                                200803
    WHEN CD_ESCOLA IN (200805,019664,700055,700546) THEN                                200805
    WHEN CD_ESCOLA IN (019670,200804,700054,700539) THEN                                200804
    WHEN CD_ESCOLA IN (200806,019669,700056,700538) THEN                                200806
    WHEN CD_ESCOLA IN (700057,019662,200807,700558) THEN                                200807
ELSE NULL END AS 'CEU'

INTO ##CEUS_UNIDADES_VINCULADAS

FROM D_ESCOLA A
JOIN D_UNIDADE_EDUCACAO B ON A.cd_escola=B.cd_unidade_educacao
JOIN D_TIPO_ESCOLA C ON A.tp_escola=C.tp_escola
WHERE A.tp_escola IN (16,17,18,19,27,31,38) AND B.tp_situacao_unidade=1


UNION

select 
cd_unidade_educacao AS CD_ESCOLA,
'CEU' AS SG_TP_ESCOLA,
nm_unidade_educacao AS NOMESC,
cd_unidade_educacao AS CEU
from D_UNIDADE_educacao where cd_unidade_educacao in (
 200183,200184,200185,200186,200187,200188,200189,200190,200191,200192,
 200193,200194,200195,200196,200197,200198,200199,200200,200201,200202,
 200203,200237,200238,200239,200240,200241,200243,200244,200245,200246,
 200247,200248,200249,200250,200251,200252,200253,200254,200255,200256,
 200257,200258,200259,200260,200261,200262,200793,200794,200795,200798,
 200799,200800,200801,200803,200805,200804,200806,200807)


SELECT 
DRE,
CD_ESCOLA,
SG_TP_ESCOLA,
nm_unidade_educacao as NM_UNIDADE_CEU,

INTO TBL_CEUS_UNIDADES

FROM ##CEUS_UNIDADES_VINCULADAS A
JOIN (SELECT 
      cd_unidade_educacao,
	  nm_unidade_educacao,
	  CASE WHEN cd_unidade_administrativa_referencia=108100 THEN 'DRE - BT'
	       WHEN cd_unidade_administrativa_referencia=108200 THEN 'DRE - CL'
		   WHEN cd_unidade_administrativa_referencia=108300 THEN 'DRE - CS'
		   WHEN cd_unidade_administrativa_referencia=108400 THEN 'DRE - FB'
		   WHEN cd_unidade_administrativa_referencia=108500 THEN 'DRE - G'
		   WHEN cd_unidade_administrativa_referencia=108600 THEN 'DRE - IP'
		   WHEN cd_unidade_administrativa_referencia=108700 THEN 'DRE - IQ'
		   WHEN cd_unidade_administrativa_referencia=108800 THEN 'DRE - JT'
		   WHEN cd_unidade_administrativa_referencia=108900 THEN 'DRE - PE'
		   WHEN cd_unidade_administrativa_referencia=109000 THEN 'DRE - PJ'
		   WHEN cd_unidade_administrativa_referencia=109100 THEN 'DRE - SA'
           WHEN cd_unidade_administrativa_referencia=109200 THEN 'DRE - SM'
		   WHEN cd_unidade_administrativa_referencia=109300 THEN 'DRE - MP'
	  ELSE NULL END AS DRE
	  FROM D_UNIDADE_educacao 
	  where tp_unidade_educacao =3 AND tp_situacao_unidade=1) B ON A.CEU=B.cd_unidade_educacao

--SELECT * FROM TBL_CEUS_UNIDADES
	  