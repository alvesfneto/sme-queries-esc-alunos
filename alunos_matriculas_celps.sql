

/*SELECT * FROM D_TIPO_PROGRAMA 
WHERE sg_tipo_programa LIKE 'CELP%'AND dt_cancelamento IS NULL 
ORDER BY cd_tipo_programa
*/

select * from SME_ALUNOS_DIARIO

SELECT 
DRE,
B.CD_ESCOLA,
B.SG_TP_ESCOLA,
B.NOMESC,
CD_TURMA_ESCOLA,
C.dc_tipo_programa,
COUNT(CD_ALUNO) AS MATRIC

INTO ##alunos_matriculas_celps

FROM SME_ALUNOS_DIARIO A
JOIN SME_ESCOLA_DIARIO B ON A.CD_ESCOLA=B.CD_ESCOLA 
JOIN (SELECT * FROM D_TIPO_PROGRAMA 
WHERE sg_tipo_programa LIKE 'CELP%'AND dt_cancelamento IS NULL ) C ON A.CD_TIPO_PROGRAMA=C.CD_TIPO_PROGRAMA

/*
WHERE A.CD_TIPO_PROGRAMA IN 
(535
,536
,537
,538
,539
,540
,541
,542
,543
,544
,545
,546
,547
,548
,549
,550
,551
,552
,570
,571
,572
,573
,574
,575
,576
,577
,578
,579
,580
,581
,582
,583
,584
,585
,586
,587
,588
,589
,590
,591
,592
,593
,613
,614
,615
,616
,617
,618
,625
,626
,627
,628
,629
,630
,631
,633
,634
,635
,636
,637
,638
,639
,640
,641
,643
,644
,645
,646
,647)
*/
GROUP BY
DRE,
B.CD_ESCOLA,
B.SG_TP_ESCOLA,
B.NOMESC,
CD_TURMA_ESCOLA,
C.dc_tipo_programa